name: Deploy para VPS v1

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v2

      - name: Atualizar código na VPS
        uses: appleboy/ssh-action@master
        with:
          host: 20.1.155.68
          username: tsilva
          password: N78mN4ykxHuskgx
          script: |
            cd /ProjetoPdf-Front
            git pull origin master
            #!/bin/bash

            # Instale as dependências
            npm install

            # Verifique se há um processo do forever em execução na porta 3000
            FOREVER_PROCESS=$(forever list | grep ":3000")

            if [ -n "$FOREVER_PROCESS" ]; then
              # Se houver um processo em execução na porta 3000, pare-o
              forever stop "$FOREVER_PROCESS"
            fi
            
            forever start -c "npm start -- -p 3000" .